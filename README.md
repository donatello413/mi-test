# Laravel Проект

Это приложение Laravel, созданное с использованием Laravel 12.0 и PHP 8.2. Проект использует Laravel Sail для
контейнеризации Docker, PostgreSQL для базы данных и Redis для кэширования.

## Требования

- [Docker](https://www.docker.com/products/docker-desktop)
- [Docker Compose](https://docs.docker.com/compose/install/)
- [Composer](https://getcomposer.org/download/) (для локальной разработки)

## Настройка проекта

### Шаг 1: Клонирование репозитория

```bash
git clone <url-репозитория>
cd m-test
```

### Шаг 2: Настройка окружения

Скопируйте пример файла окружения:

```bash
cp .env.example .env
```

Обновите файл `.env` своими учетными данными для базы данных и другими настройками конфигурации.

### Шаг 3: Установка зависимостей

Используя Composer:

```bash
composer install
```

### Шаг 4: Запуск Docker-контейнеров

Используя Laravel Sail:

```bash
./vendor/bin/sail up -d
```

Если у вас нет доступа к команде sail, вы можете использовать:

```bash
docker-compose up -d
```

### Шаг 5: Генерация ключа приложения

```bash
./vendor/bin/sail artisan key:generate
```

### Шаг 6: Запуск миграций

```bash
./vendor/bin/sail artisan migrate
```

## Запуск приложения

### Запуск приложения

```bash
./vendor/bin/sail up -d
```

Приложение будет доступно по адресу: http://localhost

### Остановка приложения

```bash
./vendor/bin/sail down
```

## Управление базой данных

Проект использует PostgreSQL 17. Конфигурация базы данных определена в файле `.env`:

```
DB_CONNECTION=pgsql
DB_HOST=pgsql
DB_PORT=5432
DB_DATABASE=имя_вашей_базы_данных
DB_USERNAME=ваше_имя_пользователя
DB_PASSWORD=ваш_пароль
```

## Дополнительные команды

### Запуск тестов

```bash
./vendor/bin/sail test
```

### Доступ к оболочке контейнера

```bash
./vendor/bin/sail shell
```

### Запуск команд Artisan

```bash
./vendor/bin/sail artisan <команда>
```

## Устранение неполадок

Если у вас возникли проблемы с правами доступа:

```bash
chmod -R 777 storage bootstrap/cache
```

Если вам нужно перестроить контейнеры:

```bash
./vendor/bin/sail build --no-cache
```

## Основные сущности и связи

### Building (Адреса)

- **Поля**:  
  `id`, `address` (адрес), `latitude` (широта), `longitude` (долгота).
- **Описание**:  
  Представляет отдельное здание, в котором могут находиться организации.

### Organization (Организации)

- **Поля**:  
  `id`, `name` (название), `slug`, `phones` (список телефонов), `building_id` (ссылка на здание).
- **Связи**:
    - `building_id` — связь многие-к-одному с Building (каждая организация обязательно относится к одному зданию).
    - Множественная связь многие-ко-многим с Business (через таблицу `business_organization`).
- **Описание**:  
  Представляет отдельную организацию/компанию, привязанную к конкретному зданию.

### Business (Направления деятельности)

- **Поля**:  
  `id`, `name` (название), `slug`, `parent_id` (родитель).
- **Связи**:
    - Иерархия бизнесов через поле `parent_id` (один бизнес может быть подкатегорией другого).
    - Множественная связь многие-ко-многим с Organization (через таблицу `business_organization`).
- **Описание**:  
  Справочник бизнесов/отраслей с возможностью построения дерева категорий.

---

### Авторизация

Для доступа к API необходимо указать ваш статический API-ключ в заголовке запроса:

``` 
Authorization: <Ваш_API_Ключ>
```

Без передачи или при ошибочном ключе сервер вернёт ошибку `401 Unauthorized`.
По дефолту используется значение из .env.example.

---

### API

### API

- Доступ к API осуществляется через версию `/v1` и требует передачи заголовка авторизации с API-ключом.
- Основные маршруты доступны в пространстве `/organizations/`:
    - `GET /v1/organizations/building` — получить список организаций по адресу здания
    - `GET /v1/organizations/business` — получить список организаций по бизнес-направлению
    - `GET /v1/organizations/geo-area` — получить список организаций в заданной гео-области
    - `GET /v1/organizations/business-tree` — получить организации по бизнес-дереву (включая дочерние категории)
- Данные по одной организации через `/organization/`:
    - `GET /v1/organization/{id}` — получить организацию по ID
    - `GET /v1/organization/name/{name}` — получить организацию по имени

Документация по методам API полностью автоматически генерируется и поддерживается с помощью
пакета [knuckleswtf/scribe](https://scribe.knuckles.wtf/), где подробно описаны доступные эндпоинты, параметры, ответы и
примеры запросов. Доступ к апи документации http://localhost/docs.

## Лицензия

Этот проект лицензирован под лицензией MIT - подробности см. в файле LICENSE.
